<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Space Invaders</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- JS -->
    <script src="js/main.js"></script>
    <script src="js/ship.js"></script>
    <script src="js/invader.js"></script>

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>

<body>
    <div id="game">
        <div id="blockOfInvaders"></div>
    </div>

    <div id="status">
        <div>Level: <span id="statusLevel">1</span></div>
        <div>Lives: <span id="statusLives">5</span></div>
        <div>Points: <span id="statusPoints">0</span></div>
    </div>
</body>
<script>
    //Initialise the game;
    var thisGame;

    $(document).keydown((key) => {
        if (key.keyCode == keySpace && gameState == "stopped") {
            // Initialising the Game;
            thisGame = new TheGame;

            // Creating Elements
            thisGame.createElements();

            // Moving the Invaders
            thisGame.moveInvaders();

            // Invaders start to attack;
            thisGame.invadersAttack();

            let levelInterval = setInterval(() => {
                if(thisGame.arrayOfInvaders.length == 0 && gameState == "running"){
                    thisGame.nextLevel();
                }

                if(thisGame.configs.lives == 0 && gameState == "running"){
                    thisGame.gameOver();
                }
            }, 200);
        }
    });

    // Capturing Ship Moviment and Firing;
    var map = {};
    var onkeydown = onkeyup = function (e) {
        e = e || event;
        map[e.keyCode] = e.type == 'keydown';

        if (gameState == "running") {
            if (map[keyLeft] == true && map[keySpace] == true) {
                thisGame.ship.move(keyLeft);
                thisGame.ship.fire();
            } else if (map[keyRight] == true && map[keySpace] == true) {
                thisGame.ship.move(keyRight);
                thisGame.ship.fire();
            } else if (map[keyRight] == true) {
                thisGame.ship.move(keyRight);
            } else if (map[keyLeft] == true) {
                thisGame.ship.move(keyLeft);
            } else if (map[keySpace] == true){
                thisGame.ship.fire();
            }
        }        
    }
</script>

</html>