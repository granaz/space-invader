<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Space Invaders</title>

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">

    <!-- JS -->
    <script src="js/main.js"></script>
    <script src="js/ship.js"></script>
    <script src="js/invader.js"></script>

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
</head>

<body>
    <div id="game">
        <div id="blockOfInvaders"></div>
    </div>

    <div id="status">
        <div>Level: <span id="statusLevel">1</span></div>
        <div>Lives: <span id="statusLives">5</span></div>
        <div>Points: <span id="statusPoints">0</span></div>
    </div>
</body>
<script>
    //Initialise the game;
    var thisGame;
    var fireTime;
    var mapKeys = {};

    $(document).keydown((key) => {
        if (key.keyCode == keySpace && gameState == "stopped") {
            // Initialising the Game;
            thisGame = new TheGame;

            // Creating Elements
            thisGame.createElements();

            // Moving the Invaders
            thisGame.moveInvaders();

            // Invaders start to attack;
            thisGame.invadersAttack();

            fireTime = thisGame.configs.fireTime;

            let levelInterval = setInterval(() => {
                if (thisGame.arrayOfInvaders.length == 0 && gameState == "running") {
                    thisGame.nextLevel();
                }

                if (thisGame.configs.lives == 0 && gameState == "running") {
                    thisGame.gameOver();
                }
            }, 200);
        }
    });


    function fireTheShip() {
        if (fireTime == 0) thisGame.ship.fire();

        fireTime--;
    }

    window.onkeydown = (e) => {
        mapKeys[e.keyCode] = true;

        if (gameState == "running") {
            if (mapKeys[keyLeft] == true && mapKeys[keySpace] == true) {
                thisGame.ship.move(keyLeft);
                fireTheShip();
            } else if (mapKeys[keyRight] == true && mapKeys[keySpace] == true) {
                thisGame.ship.move(keyRight);
                fireTheShip();
            } else if (mapKeys[keyRight] == true) {
                thisGame.ship.move(keyRight);
            } else if (mapKeys[keyLeft] == true) {
                thisGame.ship.move(keyLeft);
            } else if (mapKeys[keySpace] == true) {
                fireTheShip();
            }
        }
    }

    window.onkeyup = (e) => {
        mapKeys[e.keyCode] = false;
    }
</script>

</html>